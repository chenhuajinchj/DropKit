# 26-02-03 Codex 5.2 UI重构方案

> 基于 `DropKit-UI-Redesign-Plan.md` 与当前实现（Shelf/Clipboard/Settings/MenuBar）对比制定的 UI 重构方案。
> 目标：保留核心功能与数据流，重建为 macOS 原生系统风格，明确与 Dropover 的视觉差异。

---

## 1. 目标与范围

**目标**
- 视觉语言：macOS 原生优先、系统融合感（HUD/Popover/Settings/List/Form）。
- 差异化：去掉 Dropover 标志性 UI（拖动条、旋转堆叠、品牌色、夸张弹性动效）。
- 稳定性：不改核心业务逻辑，仅调整 UI 结构与样式。

**范围**
- Mini Shelf（Collapsed）：`ShelfPanel.swift`, `ShelfView.swift`
- Expanded Shelf：`ShelfView.swift`
- Clipboard History：`ClipboardHistoryPanel.swift`, `ClipboardHistoryView.swift`
- Settings：`SettingsView.swift`, `DropKitApp.swift`
- Menu Bar：`MenuBarController.swift`

**明确保留功能**
- 列表模式保留（Expanded Shelf）
- 关闭按钮保留（Mini/Expanded Shelf）
- 拖拽、删除、菜单、快捷键全部保留

---

## 2. 设计原则

- **系统材质优先**：HUD / Menu / Settings scene 为主。
- **系统控件优先**：`List`、`Form`、`Picker(.segmented)`、`SearchField`/`.searchable`。
- **结构克制**：减少自绘背景与阴影，强调系统密度与节奏。
- **动效克制**：统一 `.easeInOut`，减少弹性动画。

---

## 3. 组件级对比与方案

### 3.1 Mini Shelf（Collapsed）

**现状问题**
- 顶部拖动条与旋转堆叠明显偏自定义风格。
- 底部预览条带背景，视觉“卡片感”较强。

**方案调整**
- **窗体基础**：
  - `.hudWindow` 保留，`cornerRadius = 10`。
  - 保持系统阴影；不自绘阴影。
- **顶部工具栏**：
  - **保留关闭按钮**（弱化样式）。
  - 增加左侧数量圆点（最多 3 个 + `+`）。
  - 右侧 `ellipsis` 菜单按钮（替代展开按钮）。
- **缩略图堆叠**：
  - 移除旋转，使用平铺偏移（右下 3pt），类似 Dock 堆叠。
- **底部信息**：
  - 仅显示文件名或“X 个项目”，字体 `.caption/.caption2`。
- **尺寸**：
  - 收缩为 160x140（空态）/160x160（有内容）。
  - 同步 `ShelfPanel.updatePanelSize()`。

**涉及文件**
- `DropKit/Sources/Features/Shelf/ShelfPanel.swift`
- `DropKit/Sources/Features/Shelf/ShelfView.swift`

---

### 3.2 Expanded Shelf（网格 + 列表保留）

**现状问题**
- 工具栏与控件样式偏自定义，网格密度偏松，缺少系统化状态栏。

**方案调整**
- **工具栏**：
  - 左侧返回 `chevron.left`。
  - 中间标题（`X 个项目`）。
  - 右侧：清空（`trash`）+ 更多（`ellipsis`）。
  - 关闭按钮保留，弱化样式。
- **列表模式保留**：
  - 视觉收敛为系统 `List` 风格（减少自绘背景）。
- **网格布局**：
  - `GridItem(.adaptive(minimum: 80, maximum: 100), spacing: 12)`。
  - 卡片尺寸 80x80，圆角 8，阴影极轻。
- **垃圾桶格**：
  - 网格末尾固定删除区，支持拖拽删除，悬停变红。
- **底部状态栏**：
  - 显示 `总大小 · 项目数`，样式参考 Finder。
- **动效**：
  - 展开/收起使用 `.easeInOut`，去除弹性动画。

**涉及文件**
- `DropKit/Sources/Features/Shelf/ShelfView.swift`
- `DropKit/Sources/Features/Shelf/ShelfPanel.swift`

---

### 3.3 Clipboard History

**现状问题**
- HUD 材质 + 自绘搜索框 + 胶囊筛选，偏自定义样式。

**方案调整**
- **材质**：
  - Panel 改为 `.menu` 材质，圆角 10。
- **搜索**：
  - 使用系统 `SearchField`/`.searchable`。
- **筛选**：
  - `Picker` + `.segmented`。
- **列表**：
  - 使用 `List(.plain)`，行内信息更紧凑。
  - 保留收藏/复制/删除功能，但弱化 hover 按钮样式。
- **预览层**：
  - 保留，但标题与按钮风格系统化。

**涉及文件**
- `DropKit/Sources/Features/Clipboard/ClipboardHistoryPanel.swift`
- `DropKit/Sources/Features/Clipboard/ClipboardHistoryView.swift`

---

### 3.4 Settings

**现状问题**
- `SettingsView` 已是原生结构，但信息架构与文档不一致；仍存在自建窗口入口。

**方案调整**
- **入口统一**：
  - 使用 `Settings` scene 作为唯一入口。
  - 菜单栏“设置…”跳转系统 Settings 窗口。
- **Tab 架构对齐**：
  - 通用 / 悬浮窗 / 剪切板 / 快捷键 / 关于。
  - 将 `摇晃触发` 与 `文件夹监听` 功能归入“悬浮窗”或“通用”分组（不删功能）。
- **尺寸**：
  - 窗口统一 450x300。

**涉及文件**
- `DropKit/Sources/Features/Settings/SettingsView.swift`
- `DropKit/Sources/App/DropKitApp.swift`
- `DropKit/Sources/Features/Settings/SettingsWindowController.swift`

---

### 3.5 Menu Bar

- 图标统一为 SF Symbols（建议 `square.stack.3d.up`）。
- 菜单顺序与文档一致，功能保持。

**涉及文件**
- `DropKit/Sources/Features/MenuBar/MenuBarController.swift`

---

## 4. 实施顺序（建议）

1. **基础视觉统一**：HUD/Menu 材质 + 圆角统一 + 动效曲线统一。
2. **Mini Shelf 结构重排**：顶部工具栏 + 平铺堆叠 + 底部信息栏。
3. **Expanded Shelf 重排**：工具栏、网格密度、垃圾桶格、状态栏。
4. **Clipboard History**：材质、搜索、筛选、List 结构。
5. **Settings + Menu Bar**：入口统一、Tab 架构、图标调整。

---

## 5. 风险与回避

- **拖拽冲突**：若启用 `isMovableByWindowBackground` 导致文件拖拽冲突，保留 `ShelfDropView` 的拖动方式。
- **List 自定义限制**：`List` 对 hover/按钮布局有约束，需要适配交互细节。
- **功能迁移风险**：Settings Tab 重排需避免功能丢失，确保原有设置项仍可访问。

---

## 6. 验收清单

- 浅色/深色模式材质与对比度正常。
- Mini Shelf：拖放、展开/收起、关闭按钮可用。
- Expanded Shelf：网格/列表切换、拖拽删除、右键菜单。
- Clipboard：搜索、筛选、复制、收藏、删除、预览。
- Settings：Tab 切换、配置持久化正常。
- Menu Bar：图标与快捷键可用。

---

## 7. 备注

- 本方案为 UI 重构，不涉及数据结构与业务逻辑变更。
- 若后续需要实施，我可以在此方案基础上拆解为执行计划与任务列表。
